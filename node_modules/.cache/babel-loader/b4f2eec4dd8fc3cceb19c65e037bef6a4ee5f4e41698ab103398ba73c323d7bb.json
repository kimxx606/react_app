{"ast":null,"code":"var _s = $RefreshSig$();\n// import { useState, useEffect, useRef } from 'react';\n// import { useSession } from '../contexts/SessionContext';\n// import { askLLMApi } from '../services/apiService';\n\n// /**\n//  * 채팅 기능을 관리하는 커스텀 훅\n//  * @param {string} serviceId - 서비스 식별자\n//  * @returns {Object} 채팅 관련 상태와 함수\n//  */\n// const useChat = (serviceId) => {\n//   const { sessionState, updateSessionState } = useSession();\n//   const [isLoading, setIsLoading] = useState(false);\n//   const chatContainerRef = useRef(null);\n\n//   // 세션 스토리지에서 메시지 가져오기 또는 기본값 설정\n//   const messages = sessionState[`${serviceId}_messages`] || [];\n//   const language = sessionState[`${serviceId}_language`] || 'ko';\n\n//   // 메시지 저장 함수\n//   const saveMessages = (newMessages) => {\n//     updateSessionState(`${serviceId}_messages`, newMessages);\n//   };\n\n//   // 언어 변경 함수\n//   const setLanguage = (newLanguage) => {\n//     updateSessionState(`${serviceId}_language`, newLanguage);\n//   };\n\n//   // 메시지 초기화 함수\n//   const clearMessages = () => {\n//     saveMessages([]);\n//   };\n\n//   // 스크롤 기능\n//   useEffect(() => {\n//     const scrollToBottom = () => {\n//       if (chatContainerRef.current) {\n//         const scrollHeight = chatContainerRef.current.scrollHeight;\n//         chatContainerRef.current.scrollTop = scrollHeight;\n//       }\n//     };\n\n//     // 즉시 실행\n//     scrollToBottom();\n\n//     // DOM 업데이트 후 다시 실행\n//     const timer1 = setTimeout(scrollToBottom, 0);\n//     // 콘텐츠 로드 후 실행\n//     const timer2 = setTimeout(scrollToBottom, 100);\n//     // 더 긴 시간 후 다시 실행 (느린 렌더링, 이미지 로드 등 대비)\n//     const timer3 = setTimeout(scrollToBottom, 500);\n\n//     return () => {\n//       clearTimeout(timer1);\n//       clearTimeout(timer2);\n//       clearTimeout(timer3);\n//     };\n//   }, [messages, isLoading]);\n\n//   // 메시지 전송 함수\n//   const sendMessage = async (query) => {\n//     if (!query.trim()) return;\n\n//     // 사용자 메시지 추가\n//     const userMessage = { role: 'user', content: query };\n//     const updatedMessages = [...messages, userMessage];\n//     saveMessages(updatedMessages);\n\n//     // 사용자 메시지 추가 후 스크롤\n//     setTimeout(() => {\n//       if (chatContainerRef.current) {\n//         chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\n//       }\n//     }, 0);\n\n//     // API 호출\n//     setIsLoading(true);\n//     try {\n//       const result = await askLLMApi(query, language);\n\n//       if (result.success) {\n//         // 성공 응답 처리\n//         const assistantMessage = {\n//           role: 'assistant',\n//           content: result.data.result || '응답을 받지 못했습니다.'\n//         };\n//         saveMessages([...updatedMessages, assistantMessage]);\n\n//         // 응답 메시지 추가 후 스크롤\n//         setTimeout(() => {\n//           if (chatContainerRef.current) {\n//             chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\n//           }\n//         }, 0);\n//       } else {\n//         // 오류 응답 처리\n//         const errorMessage = {\n//           role: 'assistant',\n//           content: `오류가 발생했습니다: ${result.error || '알 수 없는 오류'}`,\n//           isError: true\n//         };\n//         saveMessages([...updatedMessages, errorMessage]);\n\n//         // 오류 메시지 추가 후 스크롤\n//         setTimeout(() => {\n//           if (chatContainerRef.current) {\n//             chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\n//           }\n//         }, 0);\n//       }\n//     } catch (error) {\n//       console.error('메시지 전송 중 오류:', error);\n//       const errorMessage = {\n//         role: 'assistant',\n//         content: '오류가 발생했습니다. 나중에 다시 시도해주세요.',\n//         isError: true\n//       };\n//       saveMessages([...updatedMessages, errorMessage]);\n\n//       // 오류 메시지 추가 후 스크롤\n//       setTimeout(() => {\n//         if (chatContainerRef.current) {\n//           chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\n//         }\n//       }, 0);\n//     } finally {\n//       setIsLoading(false);\n//     }\n//   };\n\n//   // 대표 질문 처리 함수\n//   const handleSampleQuestion = (question) => {\n//     sendMessage(question);\n//   };\n\n//   return {\n//     messages,\n//     isLoading,\n//     language,\n//     chatContainerRef,\n//     sendMessage,\n//     clearMessages,\n//     setLanguage,\n//     handleSampleQuestion\n//   };\n// };\n\n// export default useChat; \n\n// import { useState, useEffect, useRef, useCallback } from 'react';\n// import { useSession } from '../contexts/SessionContext';\n// import { askLLMApi } from '../services/apiService';\n\n// /**\n//  * 채팅 기능을 관리하는 커스텀 훅\n//  * @param {string} serviceId - 서비스 식별자\n//  * @returns {Object} 채팅 관련 상태와 함수\n//  */\n// const useChat = (serviceId) => {\n//   const { sessionState, updateSessionState } = useSession();\n//   const [isLoading, setIsLoading] = useState(false);\n//   const chatContainerRef = useRef(null);\n\n//   const messages = sessionState[`${serviceId}_messages`] || [];\n//   const language = sessionState[`${serviceId}_language`] || 'ko';\n\n//   const saveMessages = (newMessages) => {\n//     updateSessionState(`${serviceId}_messages`, newMessages);\n//   };\n\n//   const setLanguage = (newLanguage) => {\n//     updateSessionState(`${serviceId}_language`, newLanguage);\n//   };\n\n//   const clearMessages = () => {\n//     saveMessages([]);\n//   };\n\n//   // ✅ 하단 자동 스크롤 함수\n//   const scrollToBottom = useCallback(() => {\n//     if (chatContainerRef.current) {\n//       chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\n//     }\n//   }, []);\n\n//   // 메시지나 로딩 상태 바뀔 때마다 스크롤\n//   useEffect(() => {\n//     scrollToBottom();\n//     const timer1 = setTimeout(scrollToBottom, 0);\n//     const timer2 = setTimeout(scrollToBottom, 100);\n//     const timer3 = setTimeout(scrollToBottom, 300);\n//     return () => {\n//       clearTimeout(timer1);\n//       clearTimeout(timer2);\n//       clearTimeout(timer3);\n//     };\n//   }, [messages, isLoading, scrollToBottom]);\n\n//   const sendMessage = async (query) => {\n//     if (!query.trim()) return;\n\n//     const userMessage = { role: 'user', content: query };\n//     const updatedMessages = [...messages, userMessage];\n//     saveMessages(updatedMessages);\n//     scrollToBottom();\n\n//     setIsLoading(true);\n//     try {\n//       const result = await askLLMApi(query, language);\n\n//       const assistantMessage = {\n//         role: 'assistant',\n//         content: result.success\n//           ? result.data.result || '응답을 받지 못했습니다.'\n//           : `오류가 발생했습니다: ${result.error || '알 수 없는 오류'}`,\n//         isError: !result.success\n//       };\n\n//       saveMessages([...updatedMessages, assistantMessage]);\n//       scrollToBottom();\n//     } catch (error) {\n//       console.error('메시지 전송 중 오류:', error);\n//       const errorMessage = {\n//         role: 'assistant',\n//         content: '오류가 발생했습니다. 나중에 다시 시도해주세요.',\n//         isError: true\n//       };\n//       saveMessages([...updatedMessages, errorMessage]);\n//       scrollToBottom();\n//     } finally {\n//       setIsLoading(false);\n//     }\n//   };\n\n//   const handleSampleQuestion = (question) => {\n//     sendMessage(question);\n//   };\n\n//   return {\n//     messages,\n//     isLoading,\n//     language,\n//     chatContainerRef,\n//     sendMessage,\n//     clearMessages,\n//     setLanguage,\n//     handleSampleQuestion\n//   };\n// };\n\n// export default useChat;\n\n// import { useState, useEffect, useRef, useCallback } from 'react';\n// import { useSession } from '../contexts/SessionContext';\n// import { askLLMApi } from '../services/apiService';\n\n// /**\n//  * 채팅 기능을 관리하는 커스텀 훅\n//  * @param {string} serviceId - 서비스 식별자\n//  * @returns {Object} 채팅 관련 상태와 함수\n//  */\n// const useChat = (serviceId) => {\n//   const { sessionState, updateSessionState } = useSession();\n//   const [isLoading, setIsLoading] = useState(false);\n//   const chatContainerRef = useRef(null);\n\n//   const messages = sessionState[`${serviceId}_messages`] || [];\n//   const language = sessionState[`${serviceId}_language`] || 'ko';\n\n//   const saveMessages = (newMessages) => {\n//     updateSessionState(`${serviceId}_messages`, newMessages);\n//   };\n\n//   const setLanguage = (newLanguage) => {\n//     updateSessionState(`${serviceId}_language`, newLanguage);\n//   };\n\n//   const clearMessages = () => {\n//     saveMessages([]);\n//   };\n\n//   /**\n//    * 하단 자동 스크롤 (force: true일 때는 무조건 스크롤)\n//    */\n//   const scrollToBottom = useCallback((force = false) => {\n//     const container = chatContainerRef.current;\n//     if (container) {\n//       const isNearBottom =\n//         container.scrollHeight - container.scrollTop - container.clientHeight < 100;\n\n//       if (force || isNearBottom) {\n//         container.scrollTop = container.scrollHeight;\n//       }\n//     }\n//   }, []);\n\n//   /**\n//    * 메시지 추가될 때 하단 스크롤\n//    */\n//   useEffect(() => {\n//     scrollToBottom();\n//     const timer = setTimeout(() => scrollToBottom(), 100);\n//     return () => clearTimeout(timer);\n//   }, [messages, isLoading, scrollToBottom]);\n\n//   const sendMessage = async (query) => {\n//     if (!query.trim()) return;\n\n//     const userMessage = { role: 'user', content: query };\n//     const updatedMessages = [...messages, userMessage];\n//     saveMessages(updatedMessages);\n//     scrollToBottom(true); // 무조건 스크롤\n\n//     setIsLoading(true);\n//     try {\n//       const result = await askLLMApi(query, language);\n\n//       const assistantMessage = {\n//         role: 'assistant',\n//         content: result.success\n//           ? result.data.result || '응답을 받지 못했습니다.'\n//           : `오류가 발생했습니다: ${result.error || '알 수 없는 오류'}`,\n//         isError: !result.success\n//       };\n\n//       saveMessages([...updatedMessages, assistantMessage]);\n//       scrollToBottom(true); // 무조건 스크롤\n//     } catch (error) {\n//       console.error('메시지 전송 중 오류:', error);\n//       const errorMessage = {\n//         role: 'assistant',\n//         content: '오류가 발생했습니다. 나중에 다시 시도해주세요.',\n//         isError: true\n//       };\n//       saveMessages([...updatedMessages, errorMessage]);\n//       scrollToBottom(true); // 무조건 스크롤\n//     } finally {\n//       setIsLoading(false);\n//     }\n//   };\n\n//   const handleSampleQuestion = (question) => {\n//     sendMessage(question);\n//   };\n\n//   return {\n//     messages,\n//     isLoading,\n//     language,\n//     chatContainerRef,\n//     sendMessage,\n//     clearMessages,\n//     setLanguage,\n//     handleSampleQuestion\n//   };\n// };\n\n// export default useChat;\n\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport { useSession } from '../contexts/SessionContext';\nimport { askLLMApi } from '../services/apiService';\n\n/**\r\n * 채팅 기능을 관리하는 커스텀 훅\r\n * @param {string} serviceId - 서비스 식별자\r\n * @returns {Object} 채팅 관련 상태와 함수\r\n */\nconst useChat = serviceId => {\n  _s();\n  const {\n    sessionState,\n    updateSessionState\n  } = useSession();\n  const [isLoading, setIsLoading] = useState(false);\n  const chatContainerRef = useRef(null);\n  const bottomRef = useRef(null); // ✅ 추가\n\n  const messages = sessionState[`${serviceId}_messages`] || [];\n  const language = sessionState[`${serviceId}_language`] || 'ko';\n  const saveMessages = newMessages => {\n    updateSessionState(`${serviceId}_messages`, newMessages);\n  };\n  const setLanguage = newLanguage => {\n    updateSessionState(`${serviceId}_language`, newLanguage);\n  };\n  const clearMessages = () => {\n    saveMessages([]);\n  };\n  const scrollToBottom = useCallback(() => {\n    if (bottomRef.current) {\n      bottomRef.current.scrollIntoView({\n        behavior: 'smooth'\n      });\n    }\n  }, []);\n  useEffect(() => {\n    scrollToBottom();\n    const t1 = setTimeout(scrollToBottom, 100);\n    const t2 = setTimeout(scrollToBottom, 300);\n    return () => {\n      clearTimeout(t1);\n      clearTimeout(t2);\n    };\n  }, [messages, isLoading, scrollToBottom]);\n  const sendMessage = async query => {\n    if (!query.trim()) return;\n    const userMessage = {\n      role: 'user',\n      content: query\n    };\n    const updatedMessages = [...messages, userMessage];\n    saveMessages(updatedMessages);\n    setIsLoading(true);\n    try {\n      const result = await askLLMApi(query, language);\n      const assistantMessage = {\n        role: 'assistant',\n        content: result.success ? result.data.result || '응답을 받지 못했습니다.' : `오류가 발생했습니다: ${result.error || '알 수 없는 오류'}`,\n        isError: !result.success\n      };\n      saveMessages([...updatedMessages, assistantMessage]);\n    } catch (error) {\n      console.error('메시지 전송 중 오류:', error);\n      const errorMessage = {\n        role: 'assistant',\n        content: '오류가 발생했습니다. 나중에 다시 시도해주세요.',\n        isError: true\n      };\n      saveMessages([...updatedMessages, errorMessage]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  const handleSampleQuestion = question => {\n    sendMessage(question);\n  };\n  return {\n    messages,\n    isLoading,\n    language,\n    chatContainerRef,\n    bottomRef,\n    // ✅ 추가\n    sendMessage,\n    clearMessages,\n    setLanguage,\n    handleSampleQuestion\n  };\n};\n_s(useChat, \"xNE7idboJzPU9G0Y5Dn8dOav0eM=\", false, function () {\n  return [useSession];\n});\nexport default useChat;","map":{"version":3,"names":["useState","useEffect","useRef","useCallback","useSession","askLLMApi","useChat","serviceId","_s","sessionState","updateSessionState","isLoading","setIsLoading","chatContainerRef","bottomRef","messages","language","saveMessages","newMessages","setLanguage","newLanguage","clearMessages","scrollToBottom","current","scrollIntoView","behavior","t1","setTimeout","t2","clearTimeout","sendMessage","query","trim","userMessage","role","content","updatedMessages","result","assistantMessage","success","data","error","isError","console","errorMessage","handleSampleQuestion","question"],"sources":["D:/01_study/react_app/src/hooks/useChat.js"],"sourcesContent":["// import { useState, useEffect, useRef } from 'react';\r\n// import { useSession } from '../contexts/SessionContext';\r\n// import { askLLMApi } from '../services/apiService';\r\n\r\n// /**\r\n//  * 채팅 기능을 관리하는 커스텀 훅\r\n//  * @param {string} serviceId - 서비스 식별자\r\n//  * @returns {Object} 채팅 관련 상태와 함수\r\n//  */\r\n// const useChat = (serviceId) => {\r\n//   const { sessionState, updateSessionState } = useSession();\r\n//   const [isLoading, setIsLoading] = useState(false);\r\n//   const chatContainerRef = useRef(null);\r\n  \r\n//   // 세션 스토리지에서 메시지 가져오기 또는 기본값 설정\r\n//   const messages = sessionState[`${serviceId}_messages`] || [];\r\n//   const language = sessionState[`${serviceId}_language`] || 'ko';\r\n  \r\n//   // 메시지 저장 함수\r\n//   const saveMessages = (newMessages) => {\r\n//     updateSessionState(`${serviceId}_messages`, newMessages);\r\n//   };\r\n  \r\n//   // 언어 변경 함수\r\n//   const setLanguage = (newLanguage) => {\r\n//     updateSessionState(`${serviceId}_language`, newLanguage);\r\n//   };\r\n  \r\n//   // 메시지 초기화 함수\r\n//   const clearMessages = () => {\r\n//     saveMessages([]);\r\n//   };\r\n  \r\n//   // 스크롤 기능\r\n//   useEffect(() => {\r\n//     const scrollToBottom = () => {\r\n//       if (chatContainerRef.current) {\r\n//         const scrollHeight = chatContainerRef.current.scrollHeight;\r\n//         chatContainerRef.current.scrollTop = scrollHeight;\r\n//       }\r\n//     };\r\n\r\n//     // 즉시 실행\r\n//     scrollToBottom();\r\n\r\n//     // DOM 업데이트 후 다시 실행\r\n//     const timer1 = setTimeout(scrollToBottom, 0);\r\n//     // 콘텐츠 로드 후 실행\r\n//     const timer2 = setTimeout(scrollToBottom, 100);\r\n//     // 더 긴 시간 후 다시 실행 (느린 렌더링, 이미지 로드 등 대비)\r\n//     const timer3 = setTimeout(scrollToBottom, 500);\r\n\r\n//     return () => {\r\n//       clearTimeout(timer1);\r\n//       clearTimeout(timer2);\r\n//       clearTimeout(timer3);\r\n//     };\r\n//   }, [messages, isLoading]);\r\n  \r\n//   // 메시지 전송 함수\r\n//   const sendMessage = async (query) => {\r\n//     if (!query.trim()) return;\r\n    \r\n//     // 사용자 메시지 추가\r\n//     const userMessage = { role: 'user', content: query };\r\n//     const updatedMessages = [...messages, userMessage];\r\n//     saveMessages(updatedMessages);\r\n    \r\n//     // 사용자 메시지 추가 후 스크롤\r\n//     setTimeout(() => {\r\n//       if (chatContainerRef.current) {\r\n//         chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\r\n//       }\r\n//     }, 0);\r\n    \r\n//     // API 호출\r\n//     setIsLoading(true);\r\n//     try {\r\n//       const result = await askLLMApi(query, language);\r\n      \r\n//       if (result.success) {\r\n//         // 성공 응답 처리\r\n//         const assistantMessage = {\r\n//           role: 'assistant',\r\n//           content: result.data.result || '응답을 받지 못했습니다.'\r\n//         };\r\n//         saveMessages([...updatedMessages, assistantMessage]);\r\n        \r\n//         // 응답 메시지 추가 후 스크롤\r\n//         setTimeout(() => {\r\n//           if (chatContainerRef.current) {\r\n//             chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\r\n//           }\r\n//         }, 0);\r\n//       } else {\r\n//         // 오류 응답 처리\r\n//         const errorMessage = {\r\n//           role: 'assistant',\r\n//           content: `오류가 발생했습니다: ${result.error || '알 수 없는 오류'}`,\r\n//           isError: true\r\n//         };\r\n//         saveMessages([...updatedMessages, errorMessage]);\r\n        \r\n//         // 오류 메시지 추가 후 스크롤\r\n//         setTimeout(() => {\r\n//           if (chatContainerRef.current) {\r\n//             chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\r\n//           }\r\n//         }, 0);\r\n//       }\r\n//     } catch (error) {\r\n//       console.error('메시지 전송 중 오류:', error);\r\n//       const errorMessage = {\r\n//         role: 'assistant',\r\n//         content: '오류가 발생했습니다. 나중에 다시 시도해주세요.',\r\n//         isError: true\r\n//       };\r\n//       saveMessages([...updatedMessages, errorMessage]);\r\n      \r\n//       // 오류 메시지 추가 후 스크롤\r\n//       setTimeout(() => {\r\n//         if (chatContainerRef.current) {\r\n//           chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\r\n//         }\r\n//       }, 0);\r\n//     } finally {\r\n//       setIsLoading(false);\r\n//     }\r\n//   };\r\n  \r\n//   // 대표 질문 처리 함수\r\n//   const handleSampleQuestion = (question) => {\r\n//     sendMessage(question);\r\n//   };\r\n  \r\n//   return {\r\n//     messages,\r\n//     isLoading,\r\n//     language,\r\n//     chatContainerRef,\r\n//     sendMessage,\r\n//     clearMessages,\r\n//     setLanguage,\r\n//     handleSampleQuestion\r\n//   };\r\n// };\r\n\r\n// export default useChat; \r\n\r\n// import { useState, useEffect, useRef, useCallback } from 'react';\r\n// import { useSession } from '../contexts/SessionContext';\r\n// import { askLLMApi } from '../services/apiService';\r\n\r\n// /**\r\n//  * 채팅 기능을 관리하는 커스텀 훅\r\n//  * @param {string} serviceId - 서비스 식별자\r\n//  * @returns {Object} 채팅 관련 상태와 함수\r\n//  */\r\n// const useChat = (serviceId) => {\r\n//   const { sessionState, updateSessionState } = useSession();\r\n//   const [isLoading, setIsLoading] = useState(false);\r\n//   const chatContainerRef = useRef(null);\r\n\r\n//   const messages = sessionState[`${serviceId}_messages`] || [];\r\n//   const language = sessionState[`${serviceId}_language`] || 'ko';\r\n\r\n//   const saveMessages = (newMessages) => {\r\n//     updateSessionState(`${serviceId}_messages`, newMessages);\r\n//   };\r\n\r\n//   const setLanguage = (newLanguage) => {\r\n//     updateSessionState(`${serviceId}_language`, newLanguage);\r\n//   };\r\n\r\n//   const clearMessages = () => {\r\n//     saveMessages([]);\r\n//   };\r\n\r\n//   // ✅ 하단 자동 스크롤 함수\r\n//   const scrollToBottom = useCallback(() => {\r\n//     if (chatContainerRef.current) {\r\n//       chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\r\n//     }\r\n//   }, []);\r\n\r\n//   // 메시지나 로딩 상태 바뀔 때마다 스크롤\r\n//   useEffect(() => {\r\n//     scrollToBottom();\r\n//     const timer1 = setTimeout(scrollToBottom, 0);\r\n//     const timer2 = setTimeout(scrollToBottom, 100);\r\n//     const timer3 = setTimeout(scrollToBottom, 300);\r\n//     return () => {\r\n//       clearTimeout(timer1);\r\n//       clearTimeout(timer2);\r\n//       clearTimeout(timer3);\r\n//     };\r\n//   }, [messages, isLoading, scrollToBottom]);\r\n\r\n//   const sendMessage = async (query) => {\r\n//     if (!query.trim()) return;\r\n\r\n//     const userMessage = { role: 'user', content: query };\r\n//     const updatedMessages = [...messages, userMessage];\r\n//     saveMessages(updatedMessages);\r\n//     scrollToBottom();\r\n\r\n//     setIsLoading(true);\r\n//     try {\r\n//       const result = await askLLMApi(query, language);\r\n\r\n//       const assistantMessage = {\r\n//         role: 'assistant',\r\n//         content: result.success\r\n//           ? result.data.result || '응답을 받지 못했습니다.'\r\n//           : `오류가 발생했습니다: ${result.error || '알 수 없는 오류'}`,\r\n//         isError: !result.success\r\n//       };\r\n\r\n//       saveMessages([...updatedMessages, assistantMessage]);\r\n//       scrollToBottom();\r\n//     } catch (error) {\r\n//       console.error('메시지 전송 중 오류:', error);\r\n//       const errorMessage = {\r\n//         role: 'assistant',\r\n//         content: '오류가 발생했습니다. 나중에 다시 시도해주세요.',\r\n//         isError: true\r\n//       };\r\n//       saveMessages([...updatedMessages, errorMessage]);\r\n//       scrollToBottom();\r\n//     } finally {\r\n//       setIsLoading(false);\r\n//     }\r\n//   };\r\n\r\n//   const handleSampleQuestion = (question) => {\r\n//     sendMessage(question);\r\n//   };\r\n\r\n//   return {\r\n//     messages,\r\n//     isLoading,\r\n//     language,\r\n//     chatContainerRef,\r\n//     sendMessage,\r\n//     clearMessages,\r\n//     setLanguage,\r\n//     handleSampleQuestion\r\n//   };\r\n// };\r\n\r\n// export default useChat;\r\n\r\n// import { useState, useEffect, useRef, useCallback } from 'react';\r\n// import { useSession } from '../contexts/SessionContext';\r\n// import { askLLMApi } from '../services/apiService';\r\n\r\n// /**\r\n//  * 채팅 기능을 관리하는 커스텀 훅\r\n//  * @param {string} serviceId - 서비스 식별자\r\n//  * @returns {Object} 채팅 관련 상태와 함수\r\n//  */\r\n// const useChat = (serviceId) => {\r\n//   const { sessionState, updateSessionState } = useSession();\r\n//   const [isLoading, setIsLoading] = useState(false);\r\n//   const chatContainerRef = useRef(null);\r\n\r\n//   const messages = sessionState[`${serviceId}_messages`] || [];\r\n//   const language = sessionState[`${serviceId}_language`] || 'ko';\r\n\r\n//   const saveMessages = (newMessages) => {\r\n//     updateSessionState(`${serviceId}_messages`, newMessages);\r\n//   };\r\n\r\n//   const setLanguage = (newLanguage) => {\r\n//     updateSessionState(`${serviceId}_language`, newLanguage);\r\n//   };\r\n\r\n//   const clearMessages = () => {\r\n//     saveMessages([]);\r\n//   };\r\n\r\n//   /**\r\n//    * 하단 자동 스크롤 (force: true일 때는 무조건 스크롤)\r\n//    */\r\n//   const scrollToBottom = useCallback((force = false) => {\r\n//     const container = chatContainerRef.current;\r\n//     if (container) {\r\n//       const isNearBottom =\r\n//         container.scrollHeight - container.scrollTop - container.clientHeight < 100;\r\n\r\n//       if (force || isNearBottom) {\r\n//         container.scrollTop = container.scrollHeight;\r\n//       }\r\n//     }\r\n//   }, []);\r\n\r\n//   /**\r\n//    * 메시지 추가될 때 하단 스크롤\r\n//    */\r\n//   useEffect(() => {\r\n//     scrollToBottom();\r\n//     const timer = setTimeout(() => scrollToBottom(), 100);\r\n//     return () => clearTimeout(timer);\r\n//   }, [messages, isLoading, scrollToBottom]);\r\n\r\n//   const sendMessage = async (query) => {\r\n//     if (!query.trim()) return;\r\n\r\n//     const userMessage = { role: 'user', content: query };\r\n//     const updatedMessages = [...messages, userMessage];\r\n//     saveMessages(updatedMessages);\r\n//     scrollToBottom(true); // 무조건 스크롤\r\n\r\n//     setIsLoading(true);\r\n//     try {\r\n//       const result = await askLLMApi(query, language);\r\n\r\n//       const assistantMessage = {\r\n//         role: 'assistant',\r\n//         content: result.success\r\n//           ? result.data.result || '응답을 받지 못했습니다.'\r\n//           : `오류가 발생했습니다: ${result.error || '알 수 없는 오류'}`,\r\n//         isError: !result.success\r\n//       };\r\n\r\n//       saveMessages([...updatedMessages, assistantMessage]);\r\n//       scrollToBottom(true); // 무조건 스크롤\r\n//     } catch (error) {\r\n//       console.error('메시지 전송 중 오류:', error);\r\n//       const errorMessage = {\r\n//         role: 'assistant',\r\n//         content: '오류가 발생했습니다. 나중에 다시 시도해주세요.',\r\n//         isError: true\r\n//       };\r\n//       saveMessages([...updatedMessages, errorMessage]);\r\n//       scrollToBottom(true); // 무조건 스크롤\r\n//     } finally {\r\n//       setIsLoading(false);\r\n//     }\r\n//   };\r\n\r\n//   const handleSampleQuestion = (question) => {\r\n//     sendMessage(question);\r\n//   };\r\n\r\n//   return {\r\n//     messages,\r\n//     isLoading,\r\n//     language,\r\n//     chatContainerRef,\r\n//     sendMessage,\r\n//     clearMessages,\r\n//     setLanguage,\r\n//     handleSampleQuestion\r\n//   };\r\n// };\r\n\r\n// export default useChat;\r\n\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { useSession } from '../contexts/SessionContext';\r\nimport { askLLMApi } from '../services/apiService';\r\n\r\n/**\r\n * 채팅 기능을 관리하는 커스텀 훅\r\n * @param {string} serviceId - 서비스 식별자\r\n * @returns {Object} 채팅 관련 상태와 함수\r\n */\r\nconst useChat = (serviceId) => {\r\n  const { sessionState, updateSessionState } = useSession();\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const chatContainerRef = useRef(null);\r\n  const bottomRef = useRef(null); // ✅ 추가\r\n\r\n  const messages = sessionState[`${serviceId}_messages`] || [];\r\n  const language = sessionState[`${serviceId}_language`] || 'ko';\r\n\r\n  const saveMessages = (newMessages) => {\r\n    updateSessionState(`${serviceId}_messages`, newMessages);\r\n  };\r\n\r\n  const setLanguage = (newLanguage) => {\r\n    updateSessionState(`${serviceId}_language`, newLanguage);\r\n  };\r\n\r\n  const clearMessages = () => {\r\n    saveMessages([]);\r\n  };\r\n\r\n  const scrollToBottom = useCallback(() => {\r\n    if (bottomRef.current) {\r\n      bottomRef.current.scrollIntoView({ behavior: 'smooth' });\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n    const t1 = setTimeout(scrollToBottom, 100);\r\n    const t2 = setTimeout(scrollToBottom, 300);\r\n    return () => {\r\n      clearTimeout(t1);\r\n      clearTimeout(t2);\r\n    };\r\n  }, [messages, isLoading, scrollToBottom]);\r\n\r\n  const sendMessage = async (query) => {\r\n    if (!query.trim()) return;\r\n\r\n    const userMessage = { role: 'user', content: query };\r\n    const updatedMessages = [...messages, userMessage];\r\n    saveMessages(updatedMessages);\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await askLLMApi(query, language);\r\n\r\n      const assistantMessage = {\r\n        role: 'assistant',\r\n        content: result.success\r\n          ? result.data.result || '응답을 받지 못했습니다.'\r\n          : `오류가 발생했습니다: ${result.error || '알 수 없는 오류'}`,\r\n        isError: !result.success\r\n      };\r\n\r\n      saveMessages([...updatedMessages, assistantMessage]);\r\n    } catch (error) {\r\n      console.error('메시지 전송 중 오류:', error);\r\n      const errorMessage = {\r\n        role: 'assistant',\r\n        content: '오류가 발생했습니다. 나중에 다시 시도해주세요.',\r\n        isError: true\r\n      };\r\n      saveMessages([...updatedMessages, errorMessage]);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSampleQuestion = (question) => {\r\n    sendMessage(question);\r\n  };\r\n\r\n  return {\r\n    messages,\r\n    isLoading,\r\n    language,\r\n    chatContainerRef,\r\n    bottomRef, // ✅ 추가\r\n    sendMessage,\r\n    clearMessages,\r\n    setLanguage,\r\n    handleSampleQuestion\r\n  };\r\n};\r\n\r\nexport default useChat;\r\n"],"mappings":";AAAA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}